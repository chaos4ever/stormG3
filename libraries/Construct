# $chaos: Construct,v 1.10 2002/10/15 20:52:39 per Exp $ -*- Perl -*-

# Abstract: CONS script for the libraries.
# Author: Per Lundberg <per@chaosdev.org>

# Copyright 2002 chaos development.
# Use freely under the terms listed in the file LICENSE.

use POSIX; # for getcwd.

Conscript_chdir 0;

$build_directory = getcwd();

# Change this to wherever your chaos installation root may be.
$root = ($ARG{'root'} || '/tftpboot');
$header_directory = "$root/data/programming/c/headers";
$module_directory = "$root/system/modules";
$library_static_directory = "$root/data/programming/libraries/static";

$include = "$build_directory:$header_directory";
$hostname = `hostname`;
chop($hostname);
$warnings = '-Wall -W -Wshadow -Wpointer-arith -Waggregate-return ' .
  '-Wstrict-prototypes -Wredundant-decls -Winline -Wmissing-prototypes ' .
  '-Werror -Wcast-align -Wbad-function-cast -Wsign-compare ' .
  '-Wmissing-declarations -Wnested-externs ';

# FIXME: We need to split the libraries into three subdirectories; one
# that can be used in modules (static), one that can be used in
# programs (dynamic) and one for stuff that can be used in both
# (mostly inline functions)
$defs = '-D__STORM_KERNEL_MODULE__ ';

$install = <<EOF;
return qq(
mkdir -p \$library_static_directory
install \$library_directory/\$library_binary \$library_static_directory
touch %0:a
	 );
EOF


$cons = new cons (
		  CC => ($ENV{'CC'} || 'gcc'),
		  CPPPATH => $include,
		  CFLAGS => $warnings .
                  $defs .
		  '-O3 -g -pipe -fno-builtin -funsigned-char ' .
		  '-fomit-frame-pointer -ffreestanding -std=gnu99 ',
		  LDFLAGS => '-nostdlib'
		);	

Default qw(.);
Export qw( cons header_directory library_static_directory build_directory
	   install );
Build qw( block/Conscript
	  checksum/Conscript
	  filesystem/Conscript
	  console/Conscript
          exec/Conscript
	  log/Conscript
	  unicode/Conscript
	  vfs/Conscript
	  video/Conscript
	);
